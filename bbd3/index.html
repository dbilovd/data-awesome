<!DOCTYPE html>
<html>
	<head>
		<title> widget generation BB D3 </title>

        <link href="css/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="css/normalize.css" rel="stylesheet" type="text/css" />
        <link href="css/app.css" rel="stylesheet" type="text/css" />

		<style>
		#preview-canvas svg {
			border: 1px solid;
		}
		</style>
	</head>
	<body>
		<!--
		<div id="query">
			<form id="query-form">
				<div>
					<label>Type of Graph : </label>
					<select id="graph-type">
						<option value="bar"> Bar Graph </option>
						<option value="scatter"> Scatter points </option>
						<option value="line"> Line </option>
					</select>
				</div>
				<div>
					<button id="submit-btn" type="submit">Update Graph</button>
				</div>
			</form>
		</div>
		<div id="preview">
			<h1>Preview</h1>
			<div id="preview-canvas"> </div>
		</div>
		-->

        <nav>
            <div class="container">
                Header
            </div>
        </nav>
        
        <div class="container">
            
            <!-- widget -->
            <div class="da-widget">
                <div class="row">
                    <div class="one-third column">
                        <div class="da-column-header">
                            <h5> Configure </h5>
                        </div>
                        <div class="da-widget-form">
                            <form>
                                <div class="row">
                                    <div class="twelve columns">
                                        <label> Type of graph </label>
                                        <select class="u-full-width" id="graph-type">
                                            <option value="bar"> Bar Graph </option>
                                            <option value="scatter"> Scatter points </option>
                                            <option value="line"> Line </option>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="da-update-preview" id="da-update-preview">
                            <button id="da-update-preview-button" class="button"> Update Preview > </button>
                        </div>
                    </div>
                    <div class="two-thirds column">
                        <div class="da-column-header">
                            <h5> Preview </h5>
                        </div>
                        <div class="da-preview-canvas" id="da-preview-canvas-container">
                        	<div id="preview-canvas"> </div>
                        </div>
                    </div>
                </div>
                <!--   -->
                <div class="row da-widget-main-controls">
                    <div class="twelve column">
                        <button class="button button-primary"> Save </button>
                        <button > Cancel </button>
                    </div>
                </div>
            </div>
            

		<!-- scripts -->
		<script type="text/javascript" src="js/lib/jquery-1.11.2.js"></script>
		<script type="text/javascript" src="js/lib/underscore-min.js"></script>
		<script type="text/javascript" src="js/lib/backbone.js"></script>
		<script type="text/javascript" src="js/lib/d3.min.js"></script>
		<script type="text/javascript">
			var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13, 11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
			// var dataset = [
	  //           [5, 20], [480, 90], [250, 50], [100, 33], [330, 95], [410, 12], [475, 44], [25, 67], [85, 21], 
	  //           [220, 88],
	  //       ];
			var height = 200,
				width = 400,
				padding = 10,
				svg = d3.select("#preview-canvas").append("svg")
					.attr({
						"height" : height,
						"width" : "100%"
					});

				// Set up axis
				var xScale = d3.scale.linear()
					.domain([0, d3.max(dataset, function (data) {
						return data[0];
					})])
					.range([0, width]);
				var yScale = d3.scale.linear()
					.domain([0, d3.max(dataset, function (data) {
						return data[1];
					})])
					.range([height, 0]); // Negate so 0 is below + and above -
				var xAxis = d3.svg.axis()
					.scale(xScale)
					.orient("bottom");
				var yAxis = d3.svg.axis()
					.scale(yScale)
					.orient("left");

			/* d3 */
			function updateCanvas() {
				svg.remove();
				svg = d3.select("#preview-canvas").append("svg")
					.attr({
						"height" : height,
						"width" : "100%"
					});
			}

			function runD3 (options) {
				updateCanvas();

				switch (options.type){
					case "bar" :
						plotBar();
						break;
					case "scatter" :
						plotScatter();
						break;
					case "line" :
						plotLine();
						break;
				}
			}

			function plotBar () {
				var rects = svg.selectAll("rect")
					.data(dataset)
					.enter().append("rect")
					.attr({
						"x" : function (data, index) {
							return index * (width / dataset.length);
						},
						"y" : function (data, index){
							return height - data;
						},
						"width" : function (data) {
							return (width / dataset.length) - padding;
						},
						"height" : function (data, index) {
							return data * 10;
						}
					});
			    finish();
			}

			function plotScatter() {
				var circle = svg.selectAll("circle").data(dataset)
					.enter().append("circle")
					.attr({
						"cx" : function (data, index) {
							return index * (width / dataset.length);
						},
						"cy" : function (data, index){
							return height - data;
						},
						"r" : function (data, index) {
							return Math.sqrt(data);
						}
					});
			    finish();
			}

			function plotLine() {
				var line = d3.svg.line()
					.x(function (data, index){
						console.log(data);
					})
					.y(function (data, index) {
						console.log(data);
					});

				svg.selectAll("path")
					.data(dataset)
					.enter().append("path");
			      	// .attr("d", line);

			    finish();
			}

			function finish () {
				// Add axis
				svg.append("g").call(xAxis)
		            .attr({
		                "class" : "axis",
		                "transform" : "translate(0, " + (height - 30) + ")"
		            });
				svg.append("g").call(yAxis)
	            	.attr({
		                "class" : "axis",
		                "transform" : "translate(30, 0)",
		            });
			}

			/* Backbone */
			var FormView = Backbone.View.extend({
				el : "#da-widget-form",
			});

			var UpdatePreview = Backbone.View.extend({
				el : "#da-update-preview",
				events : {
					"click #da-update-preview-button" : "updateGraphType"
				},
				updateGraphType : function (e) {
					e.preventDefault();
					var graphType = $("#graph-type").val();
					runD3({
						"type" : graphType
					});
				}
			});
			var formView = new FormView();
			var updatePreviewContainer = new UpdatePreview();
		</script>
	</body>
</html>